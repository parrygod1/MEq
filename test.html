<html>
<head>

    <script
            src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">
    </script>
</head>
<body>

<div contenteditable="true" id="formula" style="height: 500px; width: 500px;"></div>

<p><input type="button" value="Update" onclick="replaceSelectedText()" /></p>

<script>
    var selection = '';
    document.getElementById('formula').onmouseup = function(){
        selection = window.getSelection().toString();
    };

    function upp() {
        formula = selection;


        var tex = "\\frac{3}{2}";
        this.formula.innerHTML = "\\["+tex+"\\]";
        MathJax.Hub.Queue(["Typeset",MathJax.Hub, this.formula]);

    }


    function replaceSelectedText() {
        var sel, range;
        var tex = "\\frac{3}{2}";
        //formula.innerHTML = "\\["+tex+"\\]"; // "\[\frac{3}{2}\\]"

        if (window.getSelection) {
            sel = window.getSelection();
            if (sel.rangeCount) {
                range = sel.getRangeAt(0);
                let clone = range.cloneContents()
                range.deleteContents();
                clone.innerHtml = "\\["+tex+"\\]";
                range.insertNode(document.createTextNode(MathJax.Hub.Queue(["Typeset",MathJax.Hub, clone])));
            }
        } else if (document.selection && document.selection.createRange) {
            range = document.selection.createRange();
            range.text = 'stefan';
        }
    }

</script>

</body>
</html>